{"version":3,"file":"js/843.32884d51.js","mappings":"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","sources":["webpack://xiaolou/./src/views/PublishView/index.vue","webpack://xiaolou/./src/views/PublishView/components/Visualize.vue","webpack://xiaolou/src/views/PublishView/components/Visualize.vue","webpack://xiaolou/./src/views/PublishView/components/Visualize.vue?0898","webpack://xiaolou/./src/views/PublishView/components/Visualize.vue?289a","webpack://xiaolou/./src/views/PublishView/components/SceneCard.vue","webpack://xiaolou/src/views/PublishView/components/SceneCard.vue","webpack://xiaolou/./src/views/PublishView/components/SceneCard.vue?f360","webpack://xiaolou/./src/views/PublishView/components/SceneCard.vue?7726","webpack://xiaolou/src/views/PublishView/index.vue","webpack://xiaolou/./src/views/PublishView/index.vue?b7cd","webpack://xiaolou/./src/views/PublishView/index.vue?248a"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"main\"},[_c('el-row',{staticClass:\"panel\"},[_c('el-row',{staticClass:\"main-panel\"},[_c('el-col',{staticClass:\"col-viewpoint\",attrs:{\"span\":6}},[_c('div',{staticClass:\"viewpoint-list\"},_vm._l((_vm.viewpoints),function(item){return _c('div',{key:item.id,staticClass:\"viewpoint-card\"},[_c('el-card',{class:{\n                'viewpoint-image': true,\n                'selected-image':\n                  _vm.selectedViewpoint && _vm.selectedViewpoint.id === item.id,\n              },attrs:{\"body-style\":{ padding: '0px' },\"shadow\":\"hover\"},nativeOn:{\"click\":function($event){return _vm.handleViewpointCardClick(item)}}},[_c('el-image',{attrs:{\"fit\":\"cover\",\"src\":item.backgroundUrl}})],1),_c('div',{class:{\n                'selected-name':\n                  _vm.selectedViewpoint && _vm.selectedViewpoint.id === item.id,\n              }},[_vm._v(\" \"+_vm._s(item.name)+\" \")])],1)}),0)]),_c('el-col',{staticClass:\"col-main\",attrs:{\"span\":18}},[_c('el-row',{staticClass:\"row-visualize\"},[_c('Visualize',{staticClass:\"visualize\",attrs:{\"imgList\":_vm.imgListForVisualize}})],1),_c('el-row',{staticClass:\"row-scenes\"},[_c('div',{staticClass:\"content\"},_vm._l((_vm.scenes),function(item,index){return _c('scene-card',{key:index,staticClass:\"scene-item\",attrs:{\"sceneObj\":item},on:{\"active\":_vm.handleSceneActive}})}),1)])],1)],1),_c('el-row',{staticClass:\"footer-panel\"},[_c('el-button',{staticClass:\"warn-btn\",attrs:{\"icon\":\"el-icon-back\"},on:{\"click\":_vm.handlePrevStepBtnClick}},[_vm._v(\"上一步\")]),_c('el-button',{staticClass:\"basic-btn\",attrs:{\"icon\":\"el-icon-receiving\"},on:{\"click\":_vm.handleTempSaveBtnClick}},[_vm._v(\"存草稿\")]),_c('el-button',{staticClass:\"publish-btn\",attrs:{\"icon\":\"el-icon-magic-stick\"},on:{\"click\":_vm.handleTestPublishBtnClick}},[_vm._v(\"发布\")])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"img-content\"},_vm._l((_vm.imgList),function(item,index){return _c('el-image',{key:index,staticClass:\"img\",attrs:{\"draggable\":\"false\",\"src\":item,\"fit\":\"cover\"}})}),1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"container\">\n    <div class=\"img-content\">\n      <el-image\n        draggable=\"false\"\n        v-for=\"(item, index) in imgList\"\n        :key=\"index\"\n        class=\"img\"\n        :src=\"item\"\n        fit=\"cover\"\n      ></el-image>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"Visualize\",\n  props: [\"imgList\"],\n};\n</script>\n\n<style lang=\"less\" scoped>\n.container {\n  display: flex;\n  justify-content: center;\n  position: relative;\n}\n.img-content {\n  width: 100%;\n  position: relative;\n  .img {\n    width: 100%;\n    position: absolute;\n    border-radius: 8px;\n\n    &:nth-child(n + 2) {\n      mix-blend-mode: screen; /* 混合模式为screen */\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Visualize.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Visualize.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./Visualize.vue?vue&type=template&id=20b47aca&scoped=true\"\nimport script from \"./Visualize.vue?vue&type=script&lang=js\"\nexport * from \"./Visualize.vue?vue&type=script&lang=js\"\nimport style0 from \"./Visualize.vue?vue&type=style&index=0&id=20b47aca&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"20b47aca\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-card',{staticClass:\"scene-card\",attrs:{\"shadow\":\"hover\"}},[_c('el-row',[_c('el-col',{staticClass:\"edit-col\",attrs:{\"span\":20}},[_c('div',[_c('i',{class:`mdi ${_vm.sceneMap.icon.replace(':', '-')}`}),_vm._v(\" \"+_vm._s(_vm.sceneMap.name)+\" \")])]),_c('el-col',{staticClass:\"edit-col\",attrs:{\"span\":4}},[_c('span',{on:{\"click\":_vm.handleActiveBtnClick}},[_vm._v(\"激活\")])])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <el-card class=\"scene-card\" shadow=\"hover\">\n    <el-row>\n      <el-col :span=\"20\" class=\"edit-col\">\n        <div>\n          <i :class=\"`mdi ${sceneMap.icon.replace(':', '-')}`\"></i>\n          {{ sceneMap.name }}\n        </div>\n\n        <!-- <el-row type=\"flex\">\n          <div\n            class=\"device-item\"\n            v-for=\"(value, key) in sceneMap.devices\"\n            :key=\"key\"\n          >\n            <i :class=\"`mdi mdi-${deviceTypesIcon[key]} ${key}`\">\n              {{ value }}</i\n            >\n          </div>\n        </el-row> -->\n      </el-col>\n      <el-col :span=\"4\" class=\"edit-col\">\n        <span @click=\"handleActiveBtnClick\">激活</span>\n      </el-col>\n    </el-row>\n  </el-card>\n</template>\n\n<script>\nexport default {\n  name: \"SceneCard\",\n  props: [\"sceneObj\"],\n  data() {\n    return {\n      deviceTypes: [\"switch\", \"light\", \"sensor\"],\n      deviceTypesIcon: {\n        switch: \"light-switch\",\n        light: \"ceiling-light-multiple\",\n        sensor: \"thermometer\",\n        other: \"robot\",\n      },\n    };\n  },\n  computed: {\n    // 用于页面展示的映射数据\n    sceneMap() {\n      let deviceCount = {};\n      this.sceneObj.attributes[\"entity_id\"]?.forEach((device) => {\n        let type = device.split(\".\")[0];\n        if (!this.deviceTypes.includes(type)) {\n          type = \"other\";\n        }\n        if (!deviceCount[type]) {\n          deviceCount[type] = 0;\n        }\n        deviceCount[type]++;\n      });\n      return {\n        name: this.sceneObj.attributes[\"friendly_name\"],\n        icon: this.sceneObj.attributes[\"icon\"] ?? \"home\",\n        entity_id: this.sceneObj.entity_id,\n        devices: deviceCount,\n      };\n    },\n  },\n  methods: {\n    handleActiveBtnClick() {\n      this.$emit(\"active\", this.sceneObj);\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.scene-card::v-deep {\n  display: flex;\n  width: 100%;\n  border-radius: 8px;\n  font-size: 14px;\n  .el-card__body {\n    width: 100%;\n  }\n  .el-row {\n    height: 100%;\n  }\n\n  .edit-col {\n    display: flex;\n    align-items: center;\n    height: 100%;\n    span {\n      color: #2e92fa;\n      cursor: pointer;\n      font-size: 14px;\n    }\n  }\n}\n.device-item {\n  margin-right: 8px;\n}\n.switch {\n  color: #627cf4;\n}\n.light {\n  color: #f4bc62;\n}\n.sensor {\n  color: #9562f4;\n}\n</style>\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SceneCard.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./SceneCard.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./SceneCard.vue?vue&type=template&id=46a61320&scoped=true\"\nimport script from \"./SceneCard.vue?vue&type=script&lang=js\"\nexport * from \"./SceneCard.vue?vue&type=script&lang=js\"\nimport style0 from \"./SceneCard.vue?vue&type=style&index=0&id=46a61320&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"46a61320\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div class=\"main\">\n    <el-row class=\"panel\">\n      <el-row class=\"main-panel\">\n        <el-col :span=\"6\" class=\"col-viewpoint\">\n          <!-- <div class=\"title\">视角</div> -->\n          <div class=\"viewpoint-list\">\n            <div\n              class=\"viewpoint-card\"\n              v-for=\"item in viewpoints\"\n              :key=\"item.id\"\n            >\n              <el-card\n                @click.native=\"handleViewpointCardClick(item)\"\n                :class=\"{\n                  'viewpoint-image': true,\n                  'selected-image':\n                    selectedViewpoint && selectedViewpoint.id === item.id,\n                }\"\n                :body-style=\"{ padding: '0px' }\"\n                shadow=\"hover\"\n              >\n                <el-image fit=\"cover\" :src=\"item.backgroundUrl\" />\n              </el-card>\n\n              <div\n                :class=\"{\n                  'selected-name':\n                    selectedViewpoint && selectedViewpoint.id === item.id,\n                }\"\n              >\n                {{ item.name }}\n              </div>\n            </div>\n          </div>\n        </el-col>\n        <el-col :span=\"18\" class=\"col-main\">\n          <el-row class=\"row-visualize\">\n            <Visualize class=\"visualize\" :imgList=\"imgListForVisualize\" />\n          </el-row>\n          <el-row class=\"row-scenes\">\n            <div class=\"content\">\n              <scene-card\n                v-for=\"(item, index) in scenes\"\n                :key=\"index\"\n                class=\"scene-item\"\n                :sceneObj=\"item\"\n                @active=\"handleSceneActive\"\n              ></scene-card>\n            </div>\n          </el-row>\n        </el-col>\n      </el-row>\n      <el-row class=\"footer-panel\">\n        <el-button\n          class=\"warn-btn\"\n          icon=\"el-icon-back\"\n          @click=\"handlePrevStepBtnClick\"\n          >上一步</el-button\n        >\n        <el-button\n          class=\"basic-btn\"\n          icon=\"el-icon-receiving\"\n          @click=\"handleTempSaveBtnClick\"\n          >存草稿</el-button\n        >\n        <el-button\n          class=\"publish-btn\"\n          icon=\"el-icon-magic-stick\"\n          @click=\"handleTestPublishBtnClick\"\n          >发布</el-button\n        >\n      </el-row>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { getSceneMode, updateKoolsmartCfg } from \"@/services\";\nimport Visualize from \"./components/Visualize.vue\";\nimport SceneCard from \"./components/SceneCard.vue\";\n\nexport default {\n  name: \"PublishView\",\n  components: {\n    Visualize,\n    SceneCard,\n  },\n  data() {\n    return {\n      selectedViewpoint: undefined,\n      selectedScene: undefined,\n      filteredEntities: undefined,\n      //关灯时默认显示为透明，后期需要替换到酷家乐的obs\n      transparentImg:\n        \"https://hexo-img.obs.cn-east-3.myhuaweicloud.com/llf/transparent.png\",\n    };\n  },\n  computed: {\n    imgListForVisualize() {\n      let newImgList = [];\n      if (this.selectedViewpoint) {\n        newImgList.push(this.selectedViewpoint.backgroundUrl);\n      }\n      if (this.filteredEntities) {\n        this.selectedViewpoint.entities.forEach((entity) => {\n          if (\n            entity.renderPic &&\n            Object.keys(this.filteredEntities).includes(entity.entity_id)\n          ) {\n            if (this.filteredEntities[entity.entity_id].state === \"on\")\n              newImgList.push(entity.renderPic);\n          }\n        });\n      }\n      return newImgList;\n    },\n    viewpoints() {\n      return this.$store.state.projectStore.selectedProject.viewpoints;\n    },\n    scenes() {\n      let scenes = [];\n      const projectId = this.$store.state.projectStore.selectedProject.id;\n      const entitiesFromSubscribe =\n        this.$store.state.haStore.entitiesFromSubscribe;\n      for (let entity in entitiesFromSubscribe) {\n        // 一次筛选出scene\n        if (\n          entitiesFromSubscribe[entity].attributes[\"id\"] &&\n          entity.split(\".\")[0] === \"scene\"\n        ) {\n          // 二次删选出koolsmart的scene且与当前project吻合\n          let keyArr = entitiesFromSubscribe[entity].attributes.id.split(\"_\");\n          if (keyArr[0] === \"koolsmart\" && keyArr[1] === projectId) {\n            scenes.push(entitiesFromSubscribe[entity]);\n          }\n        }\n      }\n      return scenes;\n    },\n  },\n  mounted() {\n    if (this.viewpoints) {\n      this.selectedViewpoint = this.viewpoints[0];\n    }\n  },\n  methods: {\n    handleTempSaveBtnClick() {\n      const projects = this.$store.state.projectStore.projects;\n      const selectedProject = this.$store.state.projectStore.selectedProject;\n      projects.forEach((project) => {\n        if (project.id === selectedProject.id) {\n          project = { ...selectedProject };\n        }\n      });\n\n      this.$store.commit(\"projectStore/setProjects\", projects);\n      updateKoolsmartCfg(projects).then(\n        (res) => {\n          this.$message.success(\"保存成功\");\n          this.$router.push(\"/project/index\");\n        },\n        (err) => {\n          console.log(err);\n        }\n      );\n    },\n    handleSceneActive(scene) {\n      getSceneMode({ uid: scene.attributes.id }).then(\n        (res) => {\n          this.selectedScene = res;\n          if (!this.filteredEntities) this.filteredEntities = {};\n          for (let entity in res.entities) {\n            this.$set(this.filteredEntities, entity, res.entities[entity]);\n          }\n        },\n        (err) => {\n          console.log(err);\n        }\n      );\n    },\n    handlePrevStepBtnClick() {\n      this.$router.push(\"/project/viewpoint-design\");\n    },\n    handleViewpointCardClick(viewpoint) {\n      this.selectedViewpoint = viewpoint;\n    },\n    async handleTestPublishBtnClick() {\n      const selectedProject = this.$store.state.projectStore.selectedProject;\n      const scenes = this.$store.state.sceneStore.scenes;\n      const dashboardConfig = this.buildDashboardConfig(\n        selectedProject,\n        scenes\n      );\n      await this.createKoolSmartDashboard({\n        url: `koolsmart-${selectedProject.id}`,\n        name: selectedProject.name,\n        icon: selectedProject.icon,\n      });\n      this.updateKoolSmartDashboard(\n        `koolsmart-${selectedProject.id}`,\n        dashboardConfig\n      );\n    },\n    buildDashboardConfig(project, scenes) {\n      const dashboardConfig = {\n        kiosk_mode: { hide_header: true },\n        views: [],\n      };\n      const scenesConfig = {\n        type: \"entities\",\n        view_layout: { position: \"sidebar\" },\n        entities: [],\n      };\n\n      const viewpointsConfig = {\n        type: \"vertical-stack\",\n        view_layout: { position: \"sidebar\" },\n        cards: [],\n      };\n\n      scenes.forEach((scene) => {\n        const sceneCfg = {\n          entity: scene.entity_id,\n        };\n        scenesConfig.entities.push(sceneCfg);\n      });\n      project.viewpoints.forEach((viewpoint) => {\n        const viewpointCfg = {\n          name: viewpoint.name,\n          type: \"button\",\n          show_name: true,\n          show_icon: true,\n          tap_action: {\n            action: \"navigate\",\n            navigation_path: `/koolsmart-${project.id}/${viewpoint.id}`,\n          },\n          icon: viewpoint.icon,\n          icon_height: \"30px\",\n        };\n        viewpointsConfig.cards.push(viewpointCfg);\n      });\n      project.viewpoints.forEach((viewpoint) => {\n        // 添加控制图标\n        const controlIconCfg = viewpoint.entities\n          .filter((entity) => entity.useControl)\n          .map((item) => {\n            return {\n              type: \"state-icon\",\n              icon: item.icon,\n              entity: item.entity_id,\n              tap_action: { action: \"toggle\" },\n              style: {\n                top: parseFloat(item.controlCfg.position.top) + 2 + \"%\",\n                left: parseFloat(item.controlCfg.position.left) + 2 + \"%\",\n                \"border-radius\": \"50%\",\n                \"background-color\": \"rgba(40, 40, 40, 0.95)\",\n                \"box-shadow\": \"0px 0px 8px 3px rgba(160, 160, 160,  0.7)\",\n                \"z-index\": 10,\n              },\n            };\n          });\n        const viewpointEntityCfg = viewpoint.entities\n          .filter((entity) => entity.renderPic)\n          .map((item) => {\n            return {\n              type: \"image\",\n              entity: item.entity_id,\n              tap_action: { action: \"none\" },\n              style: {\n                \"pointer-events\": \"none\",\n                top: \"50%\",\n                left: \"50%\",\n                width: \"100%\",\n                \"mix-blend-mode\": \"lighten\",\n              },\n              state_image: {\n                off: this.transparentImg,\n                on: item.renderPic ?? \"\",\n              },\n            };\n          });\n        const viewConfig = {\n          path: viewpoint.id,\n          title: viewpoint.name,\n          type: \"sidebar\",\n          cards: [\n            {\n              view_layout: { position: \"main\" },\n              type: \"picture-elements\",\n              image: viewpoint.backgroundUrl,\n              entities: viewpoint.entities.map((item) => item.entity_id),\n              elements: [...controlIconCfg, ...viewpointEntityCfg],\n            },\n            { ...scenesConfig },\n            { ...viewpointsConfig },\n          ],\n        };\n        dashboardConfig.views.push(viewConfig);\n      });\n      return dashboardConfig;\n    },\n\n    async updateKoolSmartDashboard(url, dashboardConfig) {\n      let updateHADashboardCfg = {\n        type: \"lovelace/config/save\",\n        url_path: url,\n        config: dashboardConfig,\n      };\n      this.$store.state.haStore.haWebsocket\n        .sendMessagePromise(updateHADashboardCfg)\n        .then(\n          (res) => {\n            this.$notify.success({\n              title: \"publish dashboard success\",\n            });\n            console.log(\"updateHADashboardCfg Res\", res);\n            const projects = this.$store.state.projectStore.projects;\n            const selectedProject =\n              this.$store.state.projectStore.selectedProject;\n            projects.forEach((project) => {\n              if (project.id === selectedProject.id) {\n                project = { ...selectedProject };\n              }\n            });\n\n            this.$store.commit(\"projectStore/setProjects\", projects);\n            updateKoolsmartCfg(projects);\n          },\n          (err) => {\n            console.log(\"updateHADashboardCfg Err\", err);\n          }\n        );\n    },\n\n    async createKoolSmartDashboard({ url, name, icon }) {\n      let createDashboardCfg = {\n        type: \"lovelace/dashboards/create\",\n        url_path: url,\n        mode: \"storage\",\n        require_admin: false,\n        show_in_sidebar: true,\n        title: name,\n        icon: icon,\n      };\n      // use HA Websocket API sendMessagePromise to communicate with HA\n      await this.$store.state.haStore.haWebsocket\n        .sendMessagePromise(createDashboardCfg)\n        .then(\n          (res) => {\n            console.log(\"createDashboardCfg Res\", res);\n          },\n          (err) => {\n            console.log(\"createDashboardCfg Err\", err);\n          }\n        );\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n@import \"./index.less\";\n</style>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=5bc384b0&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=5bc384b0&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5bc384b0\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","_l","viewpoints","item","key","id","class","selectedViewpoint","padding","nativeOn","$event","handleViewpointCardClick","backgroundUrl","_v","_s","name","imgListForVisualize","scenes","index","on","handleSceneActive","handlePrevStepBtnClick","handleTempSaveBtnClick","handleTestPublishBtnClick","staticRenderFns","imgList","props","component","sceneMap","icon","replace","handleActiveBtnClick","data","deviceTypes","deviceTypesIcon","switch","light","sensor","other","computed","deviceCount","sceneObj","attributes","forEach","device","type","split","includes","entity_id","devices","methods","$emit","components","Visualize","SceneCard","undefined","selectedScene","filteredEntities","transparentImg","newImgList","push","entities","entity","renderPic","Object","keys","state","$store","projectStore","selectedProject","projectId","entitiesFromSubscribe","haStore","keyArr","mounted","projects","project","commit","updateKoolsmartCfg","then","res","$message","success","$router","err","console","log","scene","getSceneMode","uid","$set","viewpoint","sceneStore","dashboardConfig","buildDashboardConfig","createKoolSmartDashboard","url","updateKoolSmartDashboard","kiosk_mode","hide_header","views","scenesConfig","view_layout","position","viewpointsConfig","cards","sceneCfg","viewpointCfg","show_name","show_icon","tap_action","action","navigation_path","icon_height","controlIconCfg","filter","useControl","map","style","top","parseFloat","controlCfg","left","viewpointEntityCfg","width","state_image","off","viewConfig","path","title","image","elements","updateHADashboardCfg","url_path","config","haWebsocket","sendMessagePromise","$notify","createDashboardCfg","mode","require_admin","show_in_sidebar"],"sourceRoot":""}