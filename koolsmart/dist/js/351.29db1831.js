"use strict";(self["webpackChunkxiaolou"]=self["webpackChunkxiaolou"]||[]).push([[351],{7351:function(e,t,i){i.r(t),i.d(t,{default:function(){return v}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-main"},[t("div",{staticClass:"project-panel"},[t("div",{staticClass:"project-list"},[t("ul",{staticClass:"img-ul"},[t("li",{staticClass:"first",on:{click:e.handleNewProjectBtnClick}},[t("div",[t("i",{staticClass:"el-icon-plus"}),t("el-button",{attrs:{round:""}},[e._v("New project")])],1),t("p")]),e._l(e.projects,(function(i){return t("li",{key:i.id},[t("project-card",{attrs:{project:i},on:{delete:()=>{e.handleProjectDeleteBtnClick(i)},edit:()=>{e.handleProjectEditBtnClick(i)}},nativeOn:{click:function(t){return(()=>{e.handleProjectCardClick(i)}).apply(null,arguments)}}})],1)}))],2)])]),t("el-dialog",{staticClass:"project-dialog",attrs:{title:"创建设计方案",visible:e.addProjectDialogFormVisible,width:"900px","modal-append-to-body":!1},on:{"update:visible":function(t){e.addProjectDialogFormVisible=t}}},[t("el-form",{staticStyle:{width:"95%"},attrs:{"label-width":"120px","label-position":"left"}},[t("el-form-item",{attrs:{label:"方案名称"}},[t("el-input",{model:{value:e.newProjectForm.name,callback:function(t){e.$set(e.newProjectForm,"name",t)},expression:"newProjectForm.name"}})],1),t("el-form-item",{attrs:{label:"图标"}},[t("el-row",{staticStyle:{width:"100%"},attrs:{type:"flex",justify:"space-between"}},[t("i",{class:`mdi ${e.newProjectForm.icon.replace(":","-")}`}),t("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择图标",filterable:""},model:{value:e.newProjectForm.icon,callback:function(t){e.$set(e.newProjectForm,"icon",t)},expression:"newProjectForm.icon"}},e._l(e.iconOptions,(function(i){return t("el-option",{key:i,attrs:{label:i,value:i}},[t("i",{class:`mdi ${i.replace(":","-")}`}),t("el-divider",{attrs:{direction:"vertical"}}),t("span",{staticStyle:{"marign-left":"40px"}},[e._v("mdi:"+e._s(i))])],1)})),1)],1)],1),t("el-form-item",{attrs:{label:"关联酷家乐方案"}})],1),t("ul",{staticClass:"demo-image"},[e._l(e.designList,(function(i){return t("li",{key:i.obsPlanId},[t("el-radio",{attrs:{label:i,border:""},model:{value:e.selectedDesign,callback:function(t){e.selectedDesign=t},expression:"selectedDesign"}},[t("el-image",{attrs:{src:i.overviewPic,fit:"fill"}}),t("div",{staticClass:"txt"},[t("p",[e._v(e._s(i.designName))])])],1)],1)})),t("div",{directives:[{name:"show",rawName:"v-show",value:e.hasMore,expression:"hasMore"}],staticClass:"load-more"},[t("span",{on:{click:e.handleLoadMoreClick}},[e._v("加载更多...")])])],2),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.handleProjectDialogConfirmBtnClick}},[e._v("开始")])],1)],1)],1)},o=[],r=(i(560),i(9872)),a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"project-card"},[t("i",{staticClass:"el-icon-edit",on:{click:function(t){return t.stopPropagation(),e.editProject.apply(null,arguments)}}}),t("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.deleteProject.apply(null,arguments)}}}),t("el-image",{attrs:{fit:"fill",src:e.project.overviewPic}}),t("p",{attrs:{title:e.project.name}},[e._v(e._s(e.project.name))])],1)},c=[],n={name:"ProjectCard",props:["project"],methods:{deleteProject(){this.$emit("delete",this.project)},editProject(){this.$emit("edit",this.project)}}},l=n,d=i(1001),m=(0,d.Z)(l,a,c,!1,null,null,null),h=m.exports,p=i(2356),u=i(3247),j=i(1273),g={name:"ProjectView",components:{ProjectCard:h},data(){return{newProjectForm:{id:void 0,name:"",icon:"mdi:home",overviewPic:"",renderPics:[],scenes:[],viewpoints:[]},addProjectDialogFormVisible:!1,editProjectDialogFormVisible:!1,projects:{},designList:[],selectedDesign:void 0,designStart:0,designNum:9,hasMore:!0,visitor:null,instance:null,iconOptions:["mdi:home","mdi:lamp","mdi:lamps","mdi:ceiling-light","mdi:chandelier","mdi:curtains","mdi:curtains-closed","mdi:desk-lamp","mdi:door","mdi:fan","mdi:fire","mdi:hanger","mdi:kettle","mdi:lock","mdi:motion-sensor","mdi:power","mdi:speaker","mdi:thermometer","mdi:toilet","mdi:video","mdi:water","mdi:window-open-variant","mdi:access-point","mdi:alarm-check","mdi:archive","mdi:bluetooth","mdi:camera-wireless","mdi:car-outline","mdi:cat","mdi:dog","mdi:email-outline","mdi:emoticon-outline","mdi:face-man-profile","mdi:face-woman-profile","mdi:key","mdi:play-circle","mdi:presentation-play","mdi:signal-variant","mdi:sleep","mdi:snowflake","mdi:wifi"]}},async created(){let e=await(0,p.Qf)().then((e=>e),(e=>null));if(e){const t=e.action[0].variables;this.$store.commit("setProjects",t.projects),this.$store.commit("setDevices",t.devices),this.$store.commit("projectStore/setProjects",t.projects),this.projects=t.projects}else(0,p.fG)().then((e=>{this.$message.success("create koolsmart config in home assistant.")})),this.$store.commit("setProjects",[]),this.$store.commit("setDevices",[]),this.$store.commit("projectStore/setProjects",[])},methods:{handleLoadMoreClick(){(0,p.Be)({start:this.designStart,num:this.designNum},this.$store.state.koolsmartStore.accountType).then((e=>{e.result&&(this.designList=this.designList.concat(e.result),this.designStart+=e.result.length),this.hasMore=e.hasMore}),(e=>{this.$message.error(e)}))},validateCreateProjectForm(){return this.newProjectForm.name?!!this.selectedDesign||(this.$message.warning("请关联酷家乐设计方案"),!1):(this.$message.warning("请填写方案名称"),!1)},async handleProjectDialogConfirmBtnClick(){if(!this.validateCreateProjectForm())return;let e=await(0,p.gp)({obsDesignId:this.selectedDesign.obsDesignId},this.$store.state.koolsmartStore.accountType).then((e=>e.renderPicInfos),(e=>(this.$message.error(e),null)));if(!e||0===e.length)return void this.$message.warning("该方案下没有可用渲染图!");let t=(0,u.Z)(),i={...this.newProjectForm,obsDesignId:this.selectedDesign.obsDesignId,overviewPic:this.selectedDesign.overviewPic,id:t,url:`koolsmart-${t}`};this.$store.commit("projectStore/setSelectedProject",i),this.$store.commit("projectStore/addProject",i),this.$message.success("new project success!"),this.$router.push("/project/scene")},async handleNewProjectBtnClick(){this.designList=await(0,p.Be)({start:0,num:this.designNum},this.$store.state.koolsmartStore.accountType).then((e=>(this.designStart=this.designNum,e.result)),(e=>(this.$message.error(e),[]))),this.addProjectDialogFormVisible=!0},handleProjectCardClick(e){this.$store.commit("projectStore/setSelectedProject",e),this.$router.push("/project/scene")},getConfig(){this.$store.state.firstLog?this.firstLog():this.projects=JSON.parse(this.$store.state.projects)},autoSave(){this.$store.dispatch("autoSave",this)},handleProjectDeleteBtnClick(e){j.log(e),this.$confirm("你确定要删除这个项目吗？","Prompt",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((t=>{let i=this.$store.state.projectStore.projects;i=i.filter((t=>t.id!==e.id)),this.$store.commit("projectStore/setProjects",i),(0,p.Gz)(i).then((e=>{this.$message.success("项目删除成功"),this.projects=i}),(e=>{j.log(e)}))}),(e=>[]))},handleProjectEditBtnClick(e){j.log(e)},handleDuplicate(e){while(e in this.projects)e="-"==e[e.length-2]?e.slice(0,e.length-1)+this.n:e+"-"+this.n,this.n+=1;return this.n=1,e},projectDialogConfirm:(0,r.Z)((function(){if(""==this.radio)return void this.$message.warning("Please select a floor plan!");let e=this.radio.split(","),t=e[0],i=e[1];i=this.handleDuplicate(i),this.$store.commit("setProjectName",i),this.$store.commit("setPlanId",t),this.projects[i]={},this.projects[i]["id"]=t,this.projects[i]["name"]=i,this.projects[i]["scenarios"]={},this.projects[i]["default"]="",this.projects[i]["scenarioList"]=[];const s=async()=>{let e=await(0,p.gp)({obsDesignId:t},this.$store.state.koolsmartStore.accountType);e.data?(0==e.data.renderPics.length?this.projects[i].default=this.visitor.renderPics[0]:this.projects[i].default=e.data.renderPics[0],this.addProjectDialogFormVisible=!1,this.projects=JSON.parse(JSON.stringify(this.projects)),this.$store.commit("setProjects",JSON.stringify(this.projects)),this.radio="",this.$router.push("/project/scene")):this.$notify.error({title:"error",message:"Server response data is empty."})};this.$store.state.isVisitor?(this.addProjectDialogFormVisible=!1,this.projects[i].default=this.visitor.renderPics[0],this.projects=JSON.parse(JSON.stringify(this.projects)),this.$store.commit("setProjects",JSON.stringify(this.projects)),this.radio="",this.$router.push("/project/scene")):s()}))}},f=g,P=(0,d.Z)(f,s,o,!1,null,"06586e75",null),v=P.exports},9872:function(e,t,i){function s(e){let t=!0;return function(){t&&(t=!1,e.call(this,arguments),setTimeout((()=>{t=!0}),2e3))}}i.d(t,{Z:function(){return s}})},3247:function(e,t,i){function s(){let e=(new Date).getTime()+Math.floor(1e7*Math.random());return e.toString()}i.d(t,{Z:function(){return s}})}}]);
//# sourceMappingURL=351.29db1831.js.map