"use strict";(self["webpackChunkxiaolou"]=self["webpackChunkxiaolou"]||[]).push([[638],{2638:function(e,t,i){i.r(t),i.d(t,{default:function(){return Z}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main"},[t("el-row",{staticClass:"panel"},[t("el-col",{staticClass:"sub-panel",attrs:{span:7}},[t("div",{staticClass:"title"},[t("div",[t("i",{staticClass:"el-icon-arrow-left",on:{click:e.handleSceneBackClick}}),e._v(e._s(e.editSceneForm.name)+" ")])]),t("div",{staticClass:"content"},[t("el-form",{attrs:{model:e.editSceneForm,"label-width":"80px","label-position":"left"}},[t("el-form-item",{attrs:{label:"名称"}},[t("el-input",{model:{value:e.editSceneForm.name,callback:function(t){e.$set(e.editSceneForm,"name",t)},expression:"editSceneForm.name"}})],1),t("el-form-item",{attrs:{label:"图标"}},[t("el-row",{staticStyle:{width:"100%"},attrs:{type:"flex",justify:"space-between"}},[t("i",{class:`mdi ${e.editSceneForm.icon.replace(":","-")}`}),t("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择图标",filterable:""},model:{value:e.editSceneForm.icon,callback:function(t){e.$set(e.editSceneForm,"icon",t)},expression:"editSceneForm.icon"}},e._l(e.iconOptions,(function(i){return t("el-option",{key:i,attrs:{label:i,value:i}},[t("i",{class:`mdi ${i.replace(":","-")}`}),t("el-divider",{attrs:{direction:"vertical"}}),t("span",{staticStyle:{"marign-left":"40px"}},[e._v("mdi:"+e._s(i))])],1)})),1)],1)],1),t("el-form-item",{attrs:{label:"实体配置"}},[t("div",{staticClass:"entity-item"},e._l(e.entityTypeCount,(function(i,s){return t("i",{key:s,class:`entity-icon mdi mdi-${e.entityTypesIcon[s]} ${s}`,style:{display:i?"":"none"}},[e._v(e._s(i))])})),0)])],1),t("div",{staticClass:"entity-list"},e._l(e.editSceneForm.entities,(function(i,s){return t("el-card",{key:s,staticClass:"entity-card",attrs:{shadow:"hover"}},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-row",[t("el-tooltip",{attrs:{content:s,placement:"top"}},[t("div",{staticClass:"name"},[t("i",{class:`mdi mdi-${e.getIconFromEntityId(s)} ${e.getEntityTypeFromEntityId(s)}`}),e._v(" "+e._s(s)+" ")])])],1),t("el-row",{attrs:{type:"flex"}},[t("div",{staticClass:"entity-item"},[t("el-radio-group",{model:{value:i.state,callback:function(t){e.$set(i,"state",t)},expression:"item.state"}},[t("el-radio",{attrs:{label:"on"}},[e._v("on")]),t("el-radio",{attrs:{label:"off"}},[e._v("off")])],1)],1)])],1),t("el-col",{staticClass:"edit-col",attrs:{span:4}},[t("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.deleteEntityBtnClick(s)}}})])],1)],1)})),1)],1),t("div",{staticClass:"footer-row"},[t("el-button",{staticClass:"warn-btn",on:{click:e.handleBackBtnClick}},[e._v("返回")]),t("el-button",{staticClass:"basic-btn",on:{click:e.handleSaveBtnClick}},[e._v("保存")])],1)]),t("el-col",{staticStyle:{padding:"20px"},attrs:{span:17}},[t("device-table",{staticStyle:{height:"600px"},on:{entityAdd:e.handleEntityAdd}})],1)],1)],1)},n=[],l=(i(560),function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"scene-card",attrs:{shadow:"hover"}},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-row",[t("div",[t("i",{class:`mdi mdi-${e.sceneMap.icon}`}),e._v(" "+e._s(e.sceneMap.name)+" ")])]),t("el-row",{attrs:{type:"flex"}},e._l(e.sceneMap.devices,(function(i,s){return t("div",{key:s,staticClass:"device-item"},[t("i",{class:`mdi mdi-${e.deviceTypesIcon[s]} ${s}`}),e._v(" "+e._s(i)+" ")])})),0)],1),t("el-col",{staticClass:"edit-col",attrs:{span:4}},[t("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.deleteBtnClick.apply(null,arguments)}}})])],1)],1)}),a=[],o={name:"SceneCard",props:["sceneObj"],data(){return{deviceTypes:["switch","light","sensor"],deviceTypesIcon:{switch:"light-switch",light:"ceiling-light-multiple",sensor:"thermometer",other:"robot"}}},computed:{sceneMap(){let e={};return this.sceneObj.attributes["entity_id"]?.forEach((t=>{let i=t.split(".")[0];this.deviceTypes.includes(i)||(i="other"),e[i]||(e[i]=0),e[i]++})),{name:this.sceneObj.attributes["friendly_name"],icon:this.sceneObj.attributes["icon"]?this.sceneObj.attributes["icon"].split(":")[1]:"home",entity_id:this.sceneObj.entity_id,devices:e}}},methods:{deleteBtnClick(){this.$emit("deleteScene",this.sceneObj)}}},c=o,r=i(1001),d=(0,r.Z)(c,l,a,!1,null,"1117f140",null),m=d.exports,h=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"entity-card",attrs:{shadow:"hover"}},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-row",[t("el-tooltip",{attrs:{content:e.entity.entity_id,placement:"top"}},[t("div",{staticClass:"title"},[t("i",{class:"mdi mdi-light-switch switch"}),e._v(" "+e._s(e.entity.entity_id)+" ")])])],1),t("el-row",{attrs:{type:"flex"}},[t("div",{staticClass:"device-item"},[t("el-radio-group",{on:{change:e.handleStateChange},model:{value:e.entityState,callback:function(t){e.entityState=t},expression:"entityState"}},[t("el-radio",{attrs:{label:"on"}},[e._v("on")]),t("el-radio",{attrs:{label:"off"}},[e._v("off")])],1)],1)])],1),t("el-col",{staticClass:"edit-col",attrs:{span:4}},[t("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.deleteBtnClick.apply(null,arguments)}}})])],1)],1)},p=[],u=i(1273),y={name:"entityCard",props:["entity"],data(){return{entityState:"off",entityTypes:["switch","light","sensor"],entityTypesIcon:{switch:"light-switch",light:"ceiling-light-multiple",sensor:"thermometer",other:"robot"}}},created(){this.entityState=this.entity.state},methods:{deleteBtnClick(){this.$emit("deleteEntity",this.entity)},handleStateChange(e){this.$emit(),u.log(e)}}},f=y,v=(0,r.Z)(f,h,p,!1,null,"5df836ad",null),b=v.exports,w=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{padding:"20px"}},[t("el-form",{attrs:{model:e.scene,"label-width":"80px","label-position":"left"}},[t("el-form-item",{attrs:{label:"名称"}},[t("el-input",{model:{value:e.scene.name,callback:function(t){e.$set(e.scene,"name",t)},expression:"scene.name"}})],1),t("el-form-item",{attrs:{label:"图标"}},[t("el-input",{model:{value:e.scene.icon,callback:function(t){e.$set(e.scene,"icon",t)},expression:"scene.icon"}})],1),t("el-form-item",{attrs:{label:"实体配置"}},[t("div",{staticClass:"device-item"},[t("i",{class:"mdi mdi-light-switch switch"}),e._v(" 3 "),t("i",{class:"mdi mdi-ceiling-light-multiple light"}),e._v(" 2 ")])]),e._l(e.scene.entities,(function(i,s){return t("el-card",{key:s,staticStyle:{padding:"10px","margin-bottom":"10px"},attrs:{shadow:"hover"}},[e._v(" "+e._s(s)+" "),t("el-radio-group",{model:{value:i.state,callback:function(t){e.$set(i,"state",t)},expression:"item.state"}},[t("el-radio",{attrs:{label:"on"}},[e._v("on")]),t("el-radio",{attrs:{label:"off"}},[e._v("off")])],1)],1)}))],2)],1)},S=[],_=i(1273),g={name:"SceneEditPanel",props:["scene"],watch:{scene(){}},created(){_.log(this.scene)}},k=g,C=(0,r.Z)(k,w,S,!1,null,null,null),$=C.exports,x=function(){var e=this,t=e._self._c;return t("div",[t("el-table",{staticClass:"local-device-table",attrs:{data:e.deviceList.filter((t=>!e.search||t.name&&t.name.includes(e.search))),height:"100%"}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(i){return e._l(i.row.entities,(function(i){return t("div",{key:i.entity_id,staticStyle:{padding:"10px"}},[t("el-button",{staticClass:"basic-btn",attrs:{icon:"el-icon-plus",size:"small"},on:{click:function(t){return e.handleEntityAddBtnClck(i.entity_id)}}},[e._v("添加 ")]),e._v(" "+e._s(i.entity_id)+" ")],1)}))}}])}),t("el-table-column",{attrs:{prop:"name",width:"300","show-overflow-tooltip":""},scopedSlots:e._u([{key:"header",fn:function(i){return[e._v(" 设备 "),t("el-input",{staticStyle:{width:"50%"},attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}}])}),t("el-table-column",{attrs:{prop:"model",label:"型号",width:"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"area_id",label:"区域",width:"120","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"identifiers[0][0]",label:"集成",width:"120","show-overflow-tooltip":""}})],1)],1)},F=[],E={name:"DeviceTable",data(){return{search:""}},computed:{deviceList(){const e=this.$store.state.haStore.deviceRegistry,t=this.$store.state.haStore.entityRegistry;return e.forEach((e=>{const i=t.filter((t=>t.device_id===e.id));e["entities"]=i})),e}},methods:{handleEntityAddBtnClck(e){this.$emit("entityAdd",e)}}},T=E,B=(0,r.Z)(T,x,F,!1,null,null,null),I=B.exports,O=i(2356),j={name:"SceneEditorView",components:{SceneCard:m,DeviceTable:I,SceneEditPanel:$,EntityCard:b},data(){return{editSceneForm:{id:void 0,name:void 0,icon:void 0,entities:{}},entityTypesIcon:{switch:"light-switch",light:"ceiling-light-multiple",sensor:"thermometer",others:"robot"},iconOptions:["mdi:home","mdi:lamp","mdi:lamps","mdi:ceiling-light","mdi:chandelier","mdi:curtains","mdi:curtains-closed","mdi:desk-lamp","mdi:door","mdi:fan","mdi:fire","mdi:hanger","mdi:kettle","mdi:lock","mdi:motion-sensor","mdi:power","mdi:speaker","mdi:thermometer","mdi:toilet","mdi:video","mdi:water","mdi:window-open-variant","mdi:access-point","mdi:alarm-check","mdi:archive","mdi:bluetooth","mdi:camera-wireless","mdi:car-outline","mdi:cat","mdi:dog","mdi:email-outline","mdi:emoticon-outline","mdi:face-man-profile","mdi:face-woman-profile","mdi:key","mdi:play-circle","mdi:presentation-play","mdi:signal-variant","mdi:sleep","mdi:snowflake","mdi:wifi"]}},computed:{entityTypeCount(){let e={switch:0,light:0,sensor:0,others:0};if(this.editSceneForm.entities)for(let t in this.editSceneForm.entities){let i=t.split(".")[0];e.hasOwnProperty(i)?e[i]++:e["others"]++}return e}},created(){this.editSceneForm={...this.$store.state.sceneStore.editScene}},methods:{handleBackBtnClick(){this.$store.commit("sceneStore/setEditScene",void 0),this.$router.push("/project/scene")},handleSaveBtnClick(){const e={uid:this.editSceneForm.id,name:this.editSceneForm.name,icon:this.editSceneForm.icon,entities:this.editSceneForm.entities};(0,O.qQ)({...e}).then((e=>{this.$message.success("保存成功"),this.$store.commit("sceneStore/setEditScene",void 0),this.$router.push("/project/scene")}),(e=>{this.$message.error(e)}))},deleteEntityBtnClick(e){this.$delete(this.editSceneForm.entities,e)},handleEntityAdd(e){const t=this.editSceneForm;t.entities.hasOwnProperty(e)?this.$message.warning("实体已添加"):this.$set(this.editSceneForm.entities,e,{state:"off"})},handleSceneBackClick(){this.$store.commit("sceneStore/setEditScene",void 0),this.$router.push("/project/scene")},getIconFromEntityId(e){let t=e.split(".")[0];return this.entityTypesIcon.hasOwnProperty(t)?this.entityTypesIcon[t]:this.entityTypesIcon["others"]},getEntityTypeFromEntityId(e){let t=e.split(".")[0];return this.entityTypesIcon.hasOwnProperty(t)?t:"others"}}},P=j,A=(0,r.Z)(P,s,n,!1,null,"51cf70f5",null),Z=A.exports}}]);
//# sourceMappingURL=638.13b8accf.js.map